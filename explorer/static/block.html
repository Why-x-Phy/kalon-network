<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block - Kalon Explorer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            adventure class="logo">
                <h1><a href="index.html" style="color: inherit; text-decoration: none;">Kalon Explorer</a></h1>
            </div>
            picture="nav">
                <a href="index.html adhesive class="active">Explorer</a它是一个 <a href="stats.html">Stats</a>
            </nav>
            <div class="search">
                <input type="text" placeholder="Search blocks, transactions or wallet addresses">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
            </div>
        </div>
    </header>

    <!-- Block Details -->
    <section class="content">
        <div class="container">
            <h2 class="section-title" id="blockTitle">Loading block...</h2>
            
            <div class="block-details">
                <div class="detail-row">
                    <div class="detail-label">Block Hash</div>
                    <div class="detail-value" id="blockHash">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Parent Hash</div>
                    <div class="detail-value" id="parentHash">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Block Reward</div>
                    <div class="detail-value" id="blockReward">5.00 tKALON</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Difficulty</div>
                    <div class="detail-value" id="difficulty">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Timestamp</div>
                    <div class="detail-value" id="timestamp">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Miner</div>
                    <div class="detail-value" id="miner">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Nonce</div>
                    <div class="detail-value" id="nonce">-</div>
                </div>
            </div>

            <h3 class="section-title" style="margin-top: 48px; font-size: 22px;">Transactions in this block</h3>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>TXID</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody id="txTable">
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 40px; color: #666;">
                                No transactions in this block
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <script>
        // Get block hash from URL
        const params = new URLSearchParams(window.location.search);
        const hash = params.get('h');
        
        if (hash) {
            // Load block details
            fetch(`http://localhost:8081/blocks/${hash}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.data) {
                        renderBlock(data.data);
                    } else {
                        renderMockBlock();
                    }
                })
                .catch(err => {
                    console.error(err);
                    renderMockBlock();
                });
        } else {
            renderMockBlock();
        }
        
        function renderBlock(block) {
            document.getElementById('blockTitle').textContent = `Block ${block.number}`;
            document.getElementById('blockHash').textContent = block.hash;
            document.getElementById('parentHash').innerHTML = `<a href="block.html?h=${block.parentHash}" class="hash-link">${block.parentHash}</a>`;
            document.getElementById('blockReward').textContent = '5.00 tKALON';
            document.getElementById('difficulty').textContent = block.difficulty;
            document.getElementById('timestamp').textContent = new Date(block.timestamp).toLocaleString();
            document.getElementById('miner').innerHTML = `<a href="#" class="hash-link">${block.miner}</a>`;
            document.getElementById('nonce').textContent = block.nonce;
            
            // Render transactions
            if (block.transactions && block.transactions.length > 0) {
                document.getElementById('txTable').innerHTML = block.transactions.map(tx => `
                    <tr>
                        <td><a href="#" class="hash-link">${tx.hash}</a></td>
                        <td><a href="#" class="hash-link">${tx.from}</a></td>
                        <td><a href="#" class="hash-link">${tx.to}</a></td>
                        <td>${(tx.amount / 1000000).toFixed(2)} tKALON</td>
                    </tr>
                `).join('');
            }
        }
        
        function renderMockBlock() {
            document.getElementById('blockTitle').textContent = 'Block #1';
            document.getElementById('blockHash').textContent = hash || 'No hash provided';
            document.getElementById('parentHash').textContent = 'Genesis block';
            document.getElementById('blockReward').textContent = '5.00 tKALON';
            document.getElementById('difficulty').textContent = '1000';
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
            document.getElementById('miner').textContent = 'kalon1...';
            document.getElementById('nonce').textContent = '0';
        }
    </script>
</body>
</html>
